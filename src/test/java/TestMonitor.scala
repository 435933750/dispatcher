import com.lx.monitor.config.ReadSchemaConfig
import com.lx.monitor.storage.MonitorStorage
import org.apache.spark.sql.SparkSession
import org.apache.spark.sql.types.{StringType, StructField, StructType}
import scala.collection.JavaConverters._

object TestMonitor {

  def main(args: Array[String]): Unit = {
    // 封号 canal_user rc_report_record
    val report = "{\"data\":[{\"id\":\"13999892\",\"use_id\":\"17353821\",\"off_time\":\"2020-01-08 08:53:56\",\"off_duration\":\"1440\",\"update_time\":\"2020-01-08 08:53:56\",\"create_time\":\"2020-01-08 08:53:56\",\"report_reason\":\"2\",\"deadline\":\"2020-01-09 08:53:56\",\"app_id\":\"20000\",\"user_level\":\"6\",\"eroticism_behavior\":\"1\",\"gender\":\"1\",\"platform_type\":\"2\",\"report_img\":\"https://d36ywu50ghf221.cloudfront.net/video-snapshot/20200108/5faa915b-60c3-4c00-a2c7-11902dfe648e.jpg\",\"user_version\":\"10132003\",\"country_id\":\"37\",\"user_type\":\"2\",\"sign_girl\":\"0\",\"register_time\":\"2018-04-24 04:23:41\",\"device_id\":\"01b1575fdba8c5f5\",\"ad_id\":\"f4493807-a22b-4a6f-9083-77deede31e90\"}],\"database\":\"rc_video_chat\",\"es\":1578473636000,\"id\":11475453,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"use_id\":\"int(11)\",\"off_time\":\"timestamp\",\"off_duration\":\"int(11)\",\"update_time\":\"timestamp\",\"create_time\":\"timestamp\",\"report_reason\":\"tinyint(4)\",\"deadline\":\"timestamp\",\"app_id\":\"int(11)\",\"user_level\":\"int(7)\",\"eroticism_behavior\":\"tinyint(1)\",\"gender\":\"tinyint(1)\",\"platform_type\":\"int(7)\",\"report_img\":\"varchar(255)\",\"user_version\":\"int(11)\",\"country_id\":\"int(11)\",\"user_type\":\"tinyint(4)\",\"sign_girl\":\"tinyint(4)\",\"register_time\":\"timestamp\",\"device_id\":\"VARCHAR(255)\",\"ad_id\":\"VARCHAR(255)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"use_id\":4,\"off_time\":93,\"off_duration\":4,\"update_time\":93,\"create_time\":93,\"report_reason\":-6,\"deadline\":93,\"app_id\":4,\"user_level\":4,\"eroticism_behavior\":-7,\"gender\":-7,\"platform_type\":4,\"report_img\":12,\"user_version\":4,\"country_id\":4,\"user_type\":-6,\"sign_girl\":-6,\"register_time\":93,\"device_id\":12,\"ad_id\":12},\"table\":\"rc_report_record\",\"ts\":1578473636403,\"type\":\"INSERT\"}"
    // 视频 canal_stat rc_video_record
    val video = "{\"data\":[{\"id\":\"422753561\",\"user_id\":\"57168254\",\"gender\":\"1\",\"matched_gender\":\"1\",\"matched_id\":\"64431504\",\"is_friend\":\"1\",\"video_time\":\"4400\",\"create_time\":\"2020-01-08 09:03:04\",\"app_id\":\"19999\",\"user_pay\":\"0\",\"match_user_pay\":\"0\",\"is_pay\":\"0\",\"user_type\":\"1\",\"match_user_type\":\"1\",\"gender_condition\":\"0\",\"eroticism\":\"0\",\"eroticism_behavior\":\"0\",\"sign_eroticism\":\"0\",\"virtual_role_id\":\"0\",\"real_role_type\":\"0\",\"user_level_id\":\"0\",\"version\":\"30129003\",\"is_real_user\":\"1\",\"match_eroticism_behavior\":\"0\",\"user_platform\":\"2\",\"match_user_platform\":null,\"match_app_id\":\"20000\",\"match_uid\":\"0\",\"user_countryid\":\"154\",\"match_user_countryid\":\"79\",\"request_type\":\"0\",\"match_mode\":\"1\",\"area\":null,\"goddess_location\":\"2\",\"goddess_video\":\"1\",\"online_status\":\"-1\",\"inapp_flag\":\"1\",\"match_flag\":\"1\",\"fee_type\":\"0\",\"room_id\":\"303708714779542605\",\"match_sign_eroticism\":\"0\",\"match_room_id\":\"303708714779542605\"}],\"database\":\"rc_live_chat_statistics\",\"es\":1578474184000,\"id\":14267396,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_id\":\"int(11)\",\"gender\":\"tinyint(4)\",\"matched_gender\":\"tinyint(4)\",\"matched_id\":\"int(11)\",\"is_friend\":\"tinyint(4)\",\"video_time\":\"bigint(20)\",\"create_time\":\"timestamp\",\"app_id\":\"int(11)\",\"user_pay\":\"tinyint(4)\",\"match_user_pay\":\"tinyint(4)\",\"is_pay\":\"tinyint(4)\",\"user_type\":\"tinyint(4)\",\"match_user_type\":\"tinyint(4)\",\"gender_condition\":\"tinyint(4)\",\"eroticism\":\"tinyint(1)\",\"eroticism_behavior\":\"tinyint(1)\",\"sign_eroticism\":\"tinyint(1)\",\"virtual_role_id\":\"int(11)\",\"real_role_type\":\"int(11)\",\"user_level_id\":\"int(11)\",\"version\":\"varchar(20)\",\"is_real_user\":\"tinyint(1)\",\"match_eroticism_behavior\":\"tinyint(1)\",\"user_platform\":\"int(7)\",\"match_user_platform\":\"int(7)\",\"match_app_id\":\"int(7)\",\"match_uid\":\"int(11)\",\"user_countryid\":\"int(11)\",\"match_user_countryid\":\"int(11)\",\"request_type\":\"tinyint(1)\",\"match_mode\":\"tinyint(4)\",\"area\":\"int(11)\",\"goddess_location\":\"tinyint(4)\",\"goddess_video\":\"tinyint(4)\",\"online_status\":\"tinyint(4)\",\"inapp_flag\":\"tinyint(4)\",\"match_flag\":\"tinyint(4)\",\"fee_type\":\"tinyint(4)\",\"room_id\":\"varchar(64)\",\"match_sign_eroticism\":\"tinyint(4)\",\"match_room_id\":\"bigint(20)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_id\":4,\"gender\":-6,\"matched_gender\":-6,\"matched_id\":4,\"is_friend\":-6,\"video_time\":-5,\"create_time\":93,\"app_id\":4,\"user_pay\":-6,\"match_user_pay\":-6,\"is_pay\":-6,\"user_type\":-6,\"match_user_type\":-6,\"gender_condition\":-6,\"eroticism\":-7,\"eroticism_behavior\":-7,\"sign_eroticism\":-7,\"virtual_role_id\":4,\"real_role_type\":4,\"user_level_id\":4,\"version\":12,\"is_real_user\":-7,\"match_eroticism_behavior\":-7,\"user_platform\":4,\"match_user_platform\":4,\"match_app_id\":4,\"match_uid\":4,\"user_countryid\":4,\"match_user_countryid\":4,\"request_type\":-7,\"match_mode\":-6,\"area\":4,\"goddess_location\":-6,\"goddess_video\":-6,\"online_status\":-6,\"inapp_flag\":-6,\"match_flag\":-6,\"fee_type\":-6,\"room_id\":12,\"match_sign_eroticism\":-6,\"match_room_id\":-5},\"table\":\"rc_video_record_even\",\"ts\":1578474184120,\"type\":\"INSERT\"}"
    // 用户 canal_user rc_user
    val user = "{\"data\":[{\"id\":\"64434434\",\"user_account\":\"\",\"three_party_id\":\"107453986372154965101\",\"three_party_email\":\"johnnynakamura7@gmail.com\",\"password\":\"\",\"user_name\":\"Jyn\",\"app_id\":\"20000\",\"background\":\"\",\"head_img\":\"https://lh5.googleusercontent.com/-y4y32lNMCG0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfx-4ByQg2Bzf1shPYvtqdBQ3WDoQ/s96-c/photo.jpg\",\"gender\":\"1\",\"country_id\":\"88\",\"country_name\":\"Japan\",\"gold_num\":\"45\",\"language_id\":\"12\",\"language_name\":\"\",\"age\":\"0\",\"birthday\":\"1990-12-09\",\"platform_type\":\"2\",\"type\":\"7\",\"pay_status\":\"0\",\"status\":\"0\",\"create_time\":\"2020-01-08 09:30:27\",\"update_time\":\"2020-01-08 09:30:29\",\"stone\":\"0\",\"stone_version\":\"10132003\",\"introduce\":\"\",\"eroticism_behavior\":\"0\",\"sign_eroticism\":\"0\",\"channel\":\"3\"}],\"database\":\"rc_video_chat\",\"es\":1578475829000,\"id\":11498477,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_account\":\"varchar(50)\",\"three_party_id\":\"varchar(50)\",\"three_party_email\":\"varchar(50)\",\"password\":\"varchar(50)\",\"user_name\":\"varchar(100)\",\"app_id\":\"int(11)\",\"background\":\"varchar(500)\",\"head_img\":\"varchar(500)\",\"gender\":\"tinyint(4)\",\"country_id\":\"tinyint(4) unsigned\",\"country_name\":\"varchar(50)\",\"gold_num\":\"decimal(10,0)\",\"language_id\":\"varchar(200)\",\"language_name\":\"varchar(500)\",\"age\":\"tinyint(4)\",\"birthday\":\"date\",\"platform_type\":\"tinyint(4) unsigned\",\"type\":\"tinyint(4)\",\"pay_status\":\"tinyint(4)\",\"status\":\"tinyint(4)\",\"create_time\":\"timestamp\",\"update_time\":\"timestamp\",\"stone\":\"decimal(10,0)\",\"stone_version\":\"int(11)\",\"introduce\":\"varchar(500)\",\"eroticism_behavior\":\"tinyint(1)\",\"sign_eroticism\":\"tinyint(1)\",\"channel\":\"tinyint(4)\"},\"old\":[{\"channel\":\"1\"}],\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_account\":12,\"three_party_id\":12,\"three_party_email\":12,\"password\":12,\"user_name\":12,\"app_id\":4,\"background\":12,\"head_img\":12,\"gender\":-6,\"country_id\":-6,\"country_name\":12,\"gold_num\":3,\"language_id\":12,\"language_name\":12,\"age\":-6,\"birthday\":91,\"platform_type\":-6,\"type\":-6,\"pay_status\":-6,\"status\":-6,\"create_time\":93,\"update_time\":93,\"stone\":3,\"stone_version\":4,\"introduce\":12,\"eroticism_behavior\":-7,\"sign_eroticism\":-7,\"channel\":-6},\"table\":\"rc_user\",\"ts\":1578475829454,\"type\":\"UPDATE\"}"
    // 登陆 canal_stat rc_user_record
    val login = "{\"data\":[{\"id\":\"787911204\",\"user_id\":\"54099313\",\"account_type\":\"3\",\"gender\":\"1\",\"type\":\"2\",\"device_type\":\"2\",\"create_time\":\"2020-01-08 09:37:42\",\"app_id\":\"19999\",\"pay_status\":\"1\",\"user_status\":\"1\",\"test\":null},{\"id\":\"787911205\",\"user_id\":\"57596922\",\"account_type\":\"2\",\"gender\":\"1\",\"type\":\"2\",\"device_type\":\"2\",\"create_time\":\"2020-01-08 09:37:43\",\"app_id\":\"20000\",\"pay_status\":\"0\",\"user_status\":\"1\",\"test\":null}],\"database\":\"rc_live_chat_statistics\",\"es\":1578476263000,\"id\":14293688,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_id\":\"int(11)\",\"account_type\":\"tinyint(4)\",\"gender\":\"tinyint(4)\",\"type\":\"tinyint(4)\",\"device_type\":\"tinyint(4)\",\"create_time\":\"timestamp\",\"app_id\":\"int(11)\",\"pay_status\":\"tinyint(4)\",\"user_status\":\"tinyint(4)\",\"test\":\"int(11)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_id\":4,\"account_type\":-6,\"gender\":-6,\"type\":-6,\"device_type\":-6,\"create_time\":93,\"app_id\":4,\"pay_status\":-6,\"user_status\":-6,\"test\":4},\"table\":\"rc_user_record\",\"ts\":1578476263101,\"type\":\"INSERT\"}"
    // 好友 canal_stat rc_friend_request_record
    val friend = "{\"data\":[{\"id\":\"178520433\",\"user_id\":\"22236672\",\"app_id\":\"20000\",\"platform_type\":\"2\",\"eroticism\":\"1\",\"gender\":\"1\",\"consume_gold\":\"60.0\",\"country\":\"84\",\"user_level\":\"5\",\"match_user_id\":\"59501200\",\"match_app_id\":\"66666\",\"match_platform_type\":\"2\",\"match_eroticism\":\"1\",\"match_gender\":\"2\",\"match_country\":\"21\",\"match_user_level\":\"0\",\"create_time\":\"2020-01-08 10:03:57\",\"request_type\":\"1\",\"busy_status\":\"0\",\"goddess_call\":\"1\",\"online_status\":\"1\",\"inapp_flag\":\"1\",\"match_flag\":\"0\",\"fee_type\":\"0\",\"room_id\":\"303712485929649240\",\"match_room_id\":\"303712485929649240\"},{\"id\":\"178520434\",\"user_id\":\"62498648\",\"app_id\":\"19999\",\"platform_type\":\"2\",\"eroticism\":\"1\",\"gender\":\"2\",\"consume_gold\":\"0.0\",\"country\":\"158\",\"user_level\":\"0\",\"match_user_id\":\"55361348\",\"match_app_id\":\"20000\",\"match_platform_type\":\"2\",\"match_eroticism\":\"0\",\"match_gender\":\"1\",\"match_country\":\"114\",\"match_user_level\":\"5\",\"create_time\":\"2020-01-08 10:03:58\",\"request_type\":\"1\",\"busy_status\":\"1\",\"goddess_call\":\"2\",\"online_status\":\"-1\",\"inapp_flag\":\"1\",\"match_flag\":\"0\",\"fee_type\":\"0\",\"room_id\":\"303712553180075008\",\"match_room_id\":\"303712553180075008\"}],\"database\":\"rc_live_chat_statistics\",\"es\":1578477838000,\"id\":14314450,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_id\":\"int(11)\",\"app_id\":\"int(11)\",\"platform_type\":\"int(11)\",\"eroticism\":\"tinyint(1)\",\"gender\":\"tinyint(1)\",\"consume_gold\":\"decimal(7,2)\",\"country\":\"int(11)\",\"user_level\":\"int(11)\",\"match_user_id\":\"int(11)\",\"match_app_id\":\"int(11)\",\"match_platform_type\":\"int(11)\",\"match_eroticism\":\"tinyint(1)\",\"match_gender\":\"tinyint(1)\",\"match_country\":\"int(11)\",\"match_user_level\":\"int(11)\",\"create_time\":\"timestamp\",\"request_type\":\"tinyint(1)\",\"busy_status\":\"tinyint(4)\",\"goddess_call\":\"tinyint(4)\",\"online_status\":\"tinyint(4)\",\"inapp_flag\":\"tinyint(4)\",\"match_flag\":\"tinyint(4)\",\"fee_type\":\"tinyint(4)\",\"room_id\":\"varchar(64)\",\"match_room_id\":\"bigint(20)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_id\":4,\"app_id\":4,\"platform_type\":4,\"eroticism\":-7,\"gender\":-7,\"consume_gold\":3,\"country\":4,\"user_level\":4,\"match_user_id\":4,\"match_app_id\":4,\"match_platform_type\":4,\"match_eroticism\":-7,\"match_gender\":-7,\"match_country\":4,\"match_user_level\":4,\"create_time\":93,\"request_type\":-7,\"busy_status\":-6,\"goddess_call\":-6,\"online_status\":-6,\"inapp_flag\":-6,\"match_flag\":-6,\"fee_type\":-6,\"room_id\":12,\"match_room_id\":-5},\"table\":\"rc_friend_request_record\",\"ts\":1578477838256,\"type\":\"INSERT\"}"
    //普通女分钟消耗
    val minute = "{\"data\":[{\"id\":\"3753757\",\"model\":\"-1\",\"is_friend\":\"1\",\"call_mode\":\"3\",\"gold_num\":\"70\",\"area_code\":\"-1\",\"role_type\":\"5\",\"create_time\":\"2020-01-08 10:52:17\",\"user_id\":\"43309390\",\"gender\":\"1\",\"app_id\":\"20000\",\"platform_type\":\"2\",\"country_id\":\"79\",\"eroticism_behavior\":\"0\",\"sign_eroticism\":\"0\",\"level\":\"6\",\"remote_user_id\":\"57863863\",\"remote_gender\":\"2\",\"remote_app_id\":\"66666\",\"remote_platform_type\":\"2\",\"remote_country_id\":\"79\",\"remote_eroticism_behavior\":\"0\",\"remote_sign_eroticism\":\"1\",\"remote_level\":\"0\"}],\"database\":\"rc_live_chat_statistics\",\"es\":1578480737000,\"id\":14351109,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"model\":\"int(11)\",\"is_friend\":\"int(4)\",\"call_mode\":\"int(4)\",\"gold_num\":\"int(11)\",\"area_code\":\"int(11)\",\"role_type\":\"int(4)\",\"create_time\":\"timestamp\",\"user_id\":\"int(11)\",\"gender\":\"int(4)\",\"app_id\":\"int(11)\",\"platform_type\":\"tinyint(4)\",\"country_id\":\"tinyint(4) unsigned\",\"eroticism_behavior\":\"tinyint(1)\",\"sign_eroticism\":\"tinyint(1)\",\"level\":\"int(11)\",\"remote_user_id\":\"int(11)\",\"remote_gender\":\"int(4)\",\"remote_app_id\":\"int(11)\",\"remote_platform_type\":\"tinyint(4)\",\"remote_country_id\":\"tinyint(4) unsigned\",\"remote_eroticism_behavior\":\"tinyint(1)\",\"remote_sign_eroticism\":\"tinyint(1)\",\"remote_level\":\"int(11)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"model\":4,\"is_friend\":4,\"call_mode\":4,\"gold_num\":4,\"area_code\":4,\"role_type\":4,\"create_time\":93,\"user_id\":4,\"gender\":4,\"app_id\":4,\"platform_type\":-6,\"country_id\":-6,\"eroticism_behavior\":-7,\"sign_eroticism\":-7,\"level\":4,\"remote_user_id\":4,\"remote_gender\":4,\"remote_app_id\":4,\"remote_platform_type\":-6,\"remote_country_id\":-6,\"remote_eroticism_behavior\":-7,\"remote_sign_eroticism\":-7,\"remote_level\":4},\"table\":\"rc_minute_goldnum_record\",\"ts\":1578480737499,\"type\":\"INSERT\"}"
    //充值 canal_user rc_user_pay_record
    val pay = "{\"data\":[{\"id\":\"11317537\",\"user_id\":\"64400941\",\"signture\":\"\",\"signtureData\":\"\",\"commodity_id\":\"19\",\"gold_num\":\"300\",\"money\":\"2.99000\",\"receipt_data\":null,\"recharge_id\":\"30000698818243\",\"transaction_id\":\"\",\"verify_result\":\"1\",\"user_device_id\":\"\",\"pay_platform\":\"2\",\"create_time\":\"2020-01-08 13:41:42\",\"verify_time\":\"2020-01-08 13:41:42\",\"google_order_id\":\"0\",\"app_id\":\"20000\",\"order_id\":null,\"event_id\":null}],\"database\":\"rc_video_chat\",\"es\":1578490902000,\"id\":11656229,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_id\":\"int(11)\",\"signture\":\"varchar(500)\",\"signtureData\":\"varchar(500)\",\"commodity_id\":\"int(11)\",\"gold_num\":\"decimal(10,0)\",\"money\":\"decimal(10,5)\",\"receipt_data\":\"text\",\"recharge_id\":\"varchar(500)\",\"transaction_id\":\"varchar(500)\",\"verify_result\":\"tinyint(4)\",\"user_device_id\":\"varchar(50)\",\"pay_platform\":\"tinyint(4)\",\"create_time\":\"timestamp\",\"verify_time\":\"timestamp\",\"google_order_id\":\"varchar(50)\",\"app_id\":\"int(11)\",\"order_id\":\"varchar(128)\",\"event_id\":\"VARCHAR(64)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_id\":4,\"signture\":12,\"signtureData\":12,\"commodity_id\":4,\"gold_num\":3,\"money\":3,\"receipt_data\":-4,\"recharge_id\":12,\"transaction_id\":12,\"verify_result\":-6,\"user_device_id\":12,\"pay_platform\":-6,\"create_time\":93,\"verify_time\":93,\"google_order_id\":12,\"app_id\":4,\"order_id\":12,\"event_id\":12},\"table\":\"rc_user_pay_record\",\"ts\":1578490902477,\"type\":\"INSERT\"}"
    //匹配成功 canal_stat rc_match_stat
    val matchStat = "{\"data\":[{\"id\":\"756698539\",\"user_id\":\"64070188\",\"is_pay\":\"2\",\"result\":\"1\",\"create_time\":\"2020-01-08 14:25:41\",\"match_user_id\":\"21912815\",\"user_gender\":\"1\",\"user_platform\":\"2\",\"match_user_gender\":\"1\",\"match_user_platform\":\"2\",\"user_country\":\"79\",\"user_ip_country\":\"\",\"match_user_country\":\"20\",\"match_user_ip_country\":\"\",\"user_pay\":\"0\",\"match_user_pay\":\"0\",\"app_id\":\"20000\",\"user_role\":\"3\",\"match_user_role\":\"0\",\"user_score\":\"0\",\"match_user_score\":\"0\",\"user_backup\":\"1\",\"match_user_backup\":\"1\",\"status\":\"2\",\"sign_eroticism\":\"0\",\"match_sign_eroticism\":\"0\",\"is_real_user\":\"1\",\"eroticism_behavior\":\"0\",\"match_eroticism_behavior\":\"0\",\"user_level_id\":\"0\",\"match_user_level_id\":\"0\",\"match_app_id\":\"20000\",\"match_mode\":\"1\",\"area\":null,\"target\":\"0\",\"match_room_id\":\"303729020426518627\"},{\"id\":\"756698540\",\"user_id\":\"64451530\",\"is_pay\":\"2\",\"result\":\"1\",\"create_time\":\"2020-01-08 14:25:41\",\"match_user_id\":\"55785886\",\"user_gender\":\"1\",\"user_platform\":\"2\",\"match_user_gender\":\"1\",\"match_user_platform\":\"2\",\"user_country\":\"80\",\"user_ip_country\":\"\",\"match_user_country\":\"20\",\"match_user_ip_country\":\"\",\"user_pay\":\"0\",\"match_user_pay\":\"0\",\"app_id\":\"20000\",\"user_role\":\"1\",\"match_user_role\":\"0\",\"user_score\":\"0\",\"match_user_score\":\"0\",\"user_backup\":\"0\",\"match_user_backup\":\"1\",\"status\":\"1\",\"sign_eroticism\":\"0\",\"match_sign_eroticism\":\"0\",\"is_real_user\":\"1\",\"eroticism_behavior\":\"0\",\"match_eroticism_behavior\":\"0\",\"user_level_id\":\"0\",\"match_user_level_id\":\"0\",\"match_app_id\":\"20000\",\"match_mode\":\"1\",\"area\":null,\"target\":\"0\",\"match_room_id\":\"303729020692861010\"},{\"id\":\"756698541\",\"user_id\":\"64452223\",\"is_pay\":\"2\",\"result\":\"1\",\"create_time\":\"2020-01-08 14:25:41\",\"match_user_id\":\"64450123\",\"user_gender\":\"1\",\"user_platform\":\"2\",\"match_user_gender\":\"1\",\"match_user_platform\":\"1\",\"user_country\":\"188\",\"user_ip_country\":\"\",\"match_user_country\":\"94\",\"match_user_ip_country\":\"\",\"user_pay\":\"0\",\"match_user_pay\":\"0\",\"app_id\":\"19999\",\"user_role\":\"1\",\"match_user_role\":\"0\",\"user_score\":\"0\",\"match_user_score\":\"0\",\"user_backup\":\"0\",\"match_user_backup\":\"0\",\"status\":\"1\",\"sign_eroticism\":\"0\",\"match_sign_eroticism\":\"0\",\"is_real_user\":\"1\",\"eroticism_behavior\":\"0\",\"match_eroticism_behavior\":\"0\",\"user_level_id\":\"0\",\"match_user_level_id\":\"0\",\"match_app_id\":\"20000\",\"match_mode\":\"1\",\"area\":null,\"target\":\"0\",\"match_room_id\":\"303729020756827211\"},{\"id\":\"756698542\",\"user_id\":\"63875172\",\"is_pay\":\"2\",\"result\":\"1\",\"create_time\":\"2020-01-08 14:25:41\",\"match_user_id\":\"10901022\",\"user_gender\":\"1\",\"user_platform\":\"2\",\"match_user_gender\":\"1\",\"match_user_platform\":\"2\",\"user_country\":\"182\",\"user_ip_country\":\"\",\"match_user_country\":\"182\",\"match_user_ip_country\":\"\",\"user_pay\":\"0\",\"match_user_pay\":\"0\",\"app_id\":\"19999\",\"user_role\":\"3\",\"match_user_role\":\"0\",\"user_score\":\"0\",\"match_user_score\":\"0\",\"user_backup\":\"1\",\"match_user_backup\":\"1\",\"status\":\"1\",\"sign_eroticism\":\"0\",\"match_sign_eroticism\":\"0\",\"is_real_user\":\"1\",\"eroticism_behavior\":\"0\",\"match_eroticism_behavior\":\"1\",\"user_level_id\":\"0\",\"match_user_level_id\":\"0\",\"match_app_id\":\"20000\",\"match_mode\":\"1\",\"area\":null,\"target\":\"0\",\"match_room_id\":\"303729020795620420\"},{\"id\":\"756698543\",\"user_id\":\"64450715\",\"is_pay\":\"2\",\"result\":\"1\",\"create_time\":\"2020-01-08 14:25:41\",\"match_user_id\":\"64137217\",\"user_gender\":\"1\",\"user_platform\":\"2\",\"match_user_gender\":\"1\",\"match_user_platform\":\"2\",\"user_country\":\"77\",\"user_ip_country\":\"\",\"match_user_country\":\"79\",\"match_user_ip_country\":\"\",\"user_pay\":\"0\",\"match_user_pay\":\"0\",\"app_id\":\"19999\",\"user_role\":\"1\",\"match_user_role\":\"0\",\"user_score\":\"0\",\"match_user_score\":\"0\",\"user_backup\":\"0\",\"match_user_backup\":\"1\",\"status\":\"1\",\"sign_eroticism\":\"0\",\"match_sign_eroticism\":\"0\",\"is_real_user\":\"1\",\"eroticism_behavior\":\"0\",\"match_eroticism_behavior\":\"0\",\"user_level_id\":\"0\",\"match_user_level_id\":\"0\",\"match_app_id\":\"20000\",\"match_mode\":\"1\",\"area\":null,\"target\":\"0\",\"match_room_id\":\"303729020820787239\"}],\"database\":\"rc_live_chat_statistics\",\"es\":1578493541000,\"id\":14574274,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_id\":\"int(11)\",\"is_pay\":\"tinyint(4)\",\"result\":\"tinyint(4)\",\"create_time\":\"timestamp\",\"match_user_id\":\"int(11)\",\"user_gender\":\"tinyint(4)\",\"user_platform\":\"tinyint(4)\",\"match_user_gender\":\"tinyint(4)\",\"match_user_platform\":\"tinyint(4)\",\"user_country\":\"varchar(50)\",\"user_ip_country\":\"varchar(50)\",\"match_user_country\":\"varchar(50)\",\"match_user_ip_country\":\"varchar(50)\",\"user_pay\":\"tinyint(4)\",\"match_user_pay\":\"tinyint(4)\",\"app_id\":\"int(11)\",\"user_role\":\"tinyint(4)\",\"match_user_role\":\"tinyint(4)\",\"user_score\":\"int(11)\",\"match_user_score\":\"int(11)\",\"user_backup\":\"int(11)\",\"match_user_backup\":\"int(11)\",\"status\":\"tinyint(4)\",\"sign_eroticism\":\"tinyint(1)\",\"match_sign_eroticism\":\"tinyint(1)\",\"is_real_user\":\"tinyint(1)\",\"eroticism_behavior\":\"tinyint(1)\",\"match_eroticism_behavior\":\"tinyint(1)\",\"user_level_id\":\"int(11)\",\"match_user_level_id\":\"int(11)\",\"match_app_id\":\"int(7)\",\"match_mode\":\"tinyint(4)\",\"area\":\"int(11)\",\"target\":\"tinyint(4)\",\"match_room_id\":\"bigint(20)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_id\":4,\"is_pay\":-6,\"result\":-6,\"create_time\":93,\"match_user_id\":4,\"user_gender\":-6,\"user_platform\":-6,\"match_user_gender\":-6,\"match_user_platform\":-6,\"user_country\":12,\"user_ip_country\":12,\"match_user_country\":12,\"match_user_ip_country\":12,\"user_pay\":-6,\"match_user_pay\":-6,\"app_id\":4,\"user_role\":-6,\"match_user_role\":-6,\"user_score\":4,\"match_user_score\":4,\"user_backup\":4,\"match_user_backup\":4,\"status\":-6,\"sign_eroticism\":-7,\"match_sign_eroticism\":-7,\"is_real_user\":-7,\"eroticism_behavior\":-7,\"match_eroticism_behavior\":-7,\"user_level_id\":4,\"match_user_level_id\":4,\"match_app_id\":4,\"match_mode\":-6,\"area\":4,\"target\":-6,\"match_room_id\":-5},\"table\":\"rc_match_stat_even\",\"ts\":1578493541643,\"type\":\"INSERT\"}"
    // 截图 canal_stat rc_video_snapshots
    val snap = "{\"data\":[{\"id\":\"346931472\",\"user_id\":\"54402370\",\"url\":\"https://d36ywu50ghf221.cloudfront.net/video-snapshot/20200110/6f45c648-28dc-457f-99fe-26d6c0810096.jpg\",\"create_time\":\"2020-01-10 06:07:32\",\"location\":\"5\",\"gender\":\"1\",\"app_id\":\"20000\",\"violations_rate\":\"0.94\",\"violations_review\":\"0\",\"violations_label\":\"2\",\"gender_rate\":null,\"gender_review\":null,\"gender_label\":null,\"pay_status\":null,\"user_level_id\":\"0\",\"review_type\":null,\"user_eroticism\":\"1\",\"room_id\":\"303878862902662198\",\"video_type\":\"1\",\"page\":\"0\",\"old_new_user\":\"0\",\"model\":\"0\",\"partner_ship\":null,\"remote_gender\":\"1\",\"platform_type\":\"2\"},{\"id\":\"346931473\",\"user_id\":\"64588923\",\"url\":\"https://d36ywu50ghf221.cloudfront.net/video-snapshot/20200110/f89b7bba-e59c-4734-aee5-a43f394af795.jpg\",\"create_time\":\"2020-01-10 06:07:32\",\"location\":\"2\",\"gender\":\"1\",\"app_id\":\"20000\",\"violations_rate\":\"0.94\",\"violations_review\":\"0\",\"violations_label\":\"2\",\"gender_rate\":null,\"gender_review\":null,\"gender_label\":null,\"pay_status\":null,\"user_level_id\":\"0\",\"review_type\":null,\"user_eroticism\":\"0\",\"room_id\":\"303878867057120259\",\"video_type\":\"1\",\"page\":\"0\",\"old_new_user\":\"1\",\"model\":\"0\",\"partner_ship\":null,\"remote_gender\":\"1\",\"platform_type\":\"2\"},{\"id\":\"346931474\",\"user_id\":\"64439414\",\"url\":\"https://d36ywu50ghf221.cloudfront.net/video-snapshot/20200110/a25a8233-a7cc-41f0-bc5f-081fcbb99f11.jpg\",\"create_time\":\"2020-01-10 06:07:32\",\"location\":\"9\",\"gender\":\"1\",\"app_id\":\"20000\",\"violations_rate\":\"0.97\",\"violations_review\":\"0\",\"violations_label\":\"2\",\"gender_rate\":null,\"gender_review\":null,\"gender_label\":null,\"pay_status\":null,\"user_level_id\":\"0\",\"review_type\":null,\"user_eroticism\":\"0\",\"room_id\":\"303878861366494276\",\"video_type\":\"1\",\"page\":\"0\",\"old_new_user\":\"0\",\"model\":\"0\",\"partner_ship\":null,\"remote_gender\":\"1\",\"platform_type\":\"2\"},{\"id\":\"346931475\",\"user_id\":\"64149278\",\"url\":\"https://d36ywu50ghf221.cloudfront.net/video-snapshot/20200110/a1c07482-89e3-4cdc-b6ca-b761ef4d9476.jpg\",\"create_time\":\"2020-01-10 06:07:33\",\"location\":\"6\",\"gender\":\"2\",\"app_id\":\"66666\",\"violations_rate\":\"0.96\",\"violations_review\":\"0\",\"violations_label\":\"2\",\"gender_rate\":null,\"gender_review\":null,\"gender_label\":null,\"pay_status\":null,\"user_level_id\":\"0\",\"review_type\":null,\"user_eroticism\":\"0\",\"room_id\":\"303878861724059677\",\"video_type\":\"1\",\"page\":\"0\",\"old_new_user\":\"0\",\"model\":\"0\",\"partner_ship\":\"2\",\"remote_gender\":\"1\",\"platform_type\":\"2\"},{\"id\":\"346931476\",\"user_id\":\"62838883\",\"url\":\"https://d36ywu50ghf221.cloudfront.net/video-snapshot/20200110/997d7dd1-750a-472d-94de-379077bd6738.jpg\",\"create_time\":\"2020-01-10 06:07:33\",\"location\":\"5\",\"gender\":\"1\",\"app_id\":\"19999\",\"violations_rate\":\"0.94\",\"violations_review\":\"0\",\"violations_label\":\"1\",\"gender_rate\":null,\"gender_review\":null,\"gender_label\":null,\"pay_status\":null,\"user_level_id\":\"0\",\"review_type\":null,\"user_eroticism\":\"0\",\"room_id\":\"303878862457019472\",\"video_type\":\"1\",\"page\":\"0\",\"old_new_user\":\"0\",\"model\":\"0\",\"partner_ship\":null,\"remote_gender\":\"1\",\"platform_type\":\"2\"}],\"database\":\"rc_live_chat_statistics\",\"es\":1578636453000,\"id\":800509,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_id\":\"int(11)\",\"url\":\"varchar(200)\",\"create_time\":\"timestamp\",\"location\":\"int(11)\",\"gender\":\"tinyint(4)\",\"app_id\":\"int(11)\",\"violations_rate\":\"float(3,2)\",\"violations_review\":\"tinyint(4)\",\"violations_label\":\"tinyint(4)\",\"gender_rate\":\"float(3,2)\",\"gender_review\":\"tinyint(4)\",\"gender_label\":\"tinyint(4)\",\"pay_status\":\"tinyint(4)\",\"user_level_id\":\"int(11)\",\"review_type\":\"int(11)\",\"user_eroticism\":\"tinyint(1)\",\"room_id\":\"varchar(255)\",\"video_type\":\"tinyint(4)\",\"page\":\"tinyint(4)\",\"old_new_user\":\"int(4)\",\"model\":\"int(4)\",\"partner_ship\":\"int(4)\",\"remote_gender\":\"int(4)\",\"platform_type\":\"int(4)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_id\":4,\"url\":12,\"create_time\":93,\"location\":4,\"gender\":-6,\"app_id\":4,\"violations_rate\":7,\"violations_review\":-6,\"violations_label\":-6,\"gender_rate\":7,\"gender_review\":-6,\"gender_label\":-6,\"pay_status\":-6,\"user_level_id\":4,\"review_type\":4,\"user_eroticism\":-7,\"room_id\":12,\"video_type\":-6,\"page\":-6,\"old_new_user\":4,\"model\":4,\"partner_ship\":4,\"remote_gender\":4,\"platform_type\":4},\"table\":\"rc_video_snapshots_even\",\"ts\":1578636453374,\"type\":\"INSERT\"}"
    //解封 canal_user rc_user_unblock_record
    val unblock = "{\"data\":[{\"id\":\"12563272\",\"user_id\":\"31801421\",\"create_time\":\"2020-01-10 06:33:01\",\"gold\":\"66\",\"platform_type\":\"1\",\"app_id\":\"20000\",\"eroticism\":\"1\",\"user_level\":\"11\",\"gender\":\"1\",\"mode\":\"1\",\"user_version\":\"129\",\"country_id\":\"138\",\"user_type\":\"0\",\"sign_girl\":\"0\",\"register_time\":\"2018-08-11 06:18:43\",\"device_id\":\"6CFAED4E-0395-43BE-BA78-6231A6C9F167\",\"ad_id\":\"2FC302B0-6AD2-4243-B55D-0C23A8AE09A3\"}],\"database\":\"rc_video_chat\",\"es\":1578637981000,\"id\":673356,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_id\":\"int(11)\",\"create_time\":\"timestamp\",\"gold\":\"decimal(10,0)\",\"platform_type\":\"int(7)\",\"app_id\":\"int(7)\",\"eroticism\":\"tinyint(4)\",\"user_level\":\"tinyint(4)\",\"gender\":\"tinyint(4)\",\"mode\":\"tinyint(4)\",\"user_version\":\"int(11)\",\"country_id\":\"int(11)\",\"user_type\":\"tinyint(4)\",\"sign_girl\":\"tinyint(4)\",\"register_time\":\"timestamp\",\"device_id\":\"varchar(255)\",\"ad_id\":\"varchar(255)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_id\":4,\"create_time\":93,\"gold\":3,\"platform_type\":4,\"app_id\":4,\"eroticism\":-6,\"user_level\":-6,\"gender\":-6,\"mode\":-6,\"user_version\":4,\"country_id\":4,\"user_type\":-6,\"sign_girl\":-6,\"register_time\":93,\"device_id\":12,\"ad_id\":12},\"table\":\"rc_user_unblock_record\",\"ts\":1578637981740,\"type\":\"INSERT\"}"
    //礼物 canal_stat rc_new_user_gift_detail
    val gift = "{\"data\":[{\"id\":\"9261300\",\"user_app_id\":\"20000\",\"user_gender\":\"2\",\"user_country_id\":\"139\",\"user_id\":\"58393260\",\"user_platform_type\":\"2\",\"gift_id\":\"86\",\"gift_gold\":\"100\",\"gift_star\":\"100\",\"send_user_platform_type\":\"1\",\"send_user_app_id\":\"20000\",\"send_user_country_id\":\"85\",\"send_user_role_id\":\"0\",\"send_user_id\":\"32064041\",\"create_time\":\"2020-01-10 09:16:02\",\"gift_location\":\"1\",\"gift_name\":\"Rose\",\"send_user_level_id\":\"12\",\"gender\":\"1\",\"gift_type\":\"1\",\"source\":null,\"draw_gold\":null,\"gift_get_id\":null,\"role\":\"0\"}],\"database\":\"rc_live_chat_statistics\",\"es\":1578647762000,\"id\":962552,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_app_id\":\"int(11)\",\"user_gender\":\"tinyint(4)\",\"user_country_id\":\"int(11) unsigned\",\"user_id\":\"int(11)\",\"user_platform_type\":\"tinyint(4)\",\"gift_id\":\"int(11)\",\"gift_gold\":\"decimal(10,0)\",\"gift_star\":\"int(11)\",\"send_user_platform_type\":\"tinyint(4)\",\"send_user_app_id\":\"int(11)\",\"send_user_country_id\":\"int(11) unsigned\",\"send_user_role_id\":\"int(11)\",\"send_user_id\":\"int(11)\",\"create_time\":\"timestamp\",\"gift_location\":\"tinyint(4)\",\"gift_name\":\"varchar(50)\",\"send_user_level_id\":\"tinyint(4)\",\"gender\":\"int(11)\",\"gift_type\":\"tinyint(4)\",\"source\":\"int(4)\",\"draw_gold\":\"decimal(10,0)\",\"gift_get_id\":\"bigint(20)\",\"role\":\"smallint(6)\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_app_id\":4,\"user_gender\":-6,\"user_country_id\":4,\"user_id\":4,\"user_platform_type\":-6,\"gift_id\":4,\"gift_gold\":3,\"gift_star\":4,\"send_user_platform_type\":-6,\"send_user_app_id\":4,\"send_user_country_id\":4,\"send_user_role_id\":4,\"send_user_id\":4,\"create_time\":93,\"gift_location\":-6,\"gift_name\":12,\"send_user_level_id\":-6,\"gender\":4,\"gift_type\":-6,\"source\":4,\"draw_gold\":3,\"gift_get_id\":-5,\"role\":5},\"table\":\"rc_new_user_gift_detail\",\"ts\":1578647762563,\"type\":\"INSERT\"}"


    val test = "{\"data\":[{\"id\":\"64992940\",\"user_account\":\"\",\"three_party_id\":\"1481189718722446\",\"three_party_email\":\"\",\"password\":\"\",\"user_name\":\"vaghela ketan\",\"app_id\":\"66666\",\"background\":\"\",\"head_img\":\"http://lcpic11.rcplatformhk.com/user-icon/male3.png\",\"gender\":\"1\",\"country_id\":\"79\",\"country_name\":\"India\",\"gold_num\":\"45\",\"language_id\":\"1\",\"language_name\":\"\",\"age\":\"0\",\"birthday\":\"1999-11-05\",\"platform_type\":\"2\",\"type\":\"6\",\"pay_status\":\"0\",\"status\":\"0\",\"create_time\":\"2020-01-14 16:43:54\",\"update_time\":\"2020-01-14 16:44:08\",\"stone\":\"6203\",\"stone_version\":\"10005001\",\"introduce\":\"\",\"eroticism_behavior\":\"0\",\"sign_eroticism\":\"0\",\"channel\":\"3\"}],\"database\":\"rc_video_chat\",\"es\":1579020248000,\"id\":4692244,\"isDdl\":false,\"mysqlType\":{\"id\":\"int(11)\",\"user_account\":\"varchar(50)\",\"three_party_id\":\"varchar(50)\",\"three_party_email\":\"varchar(50)\",\"password\":\"varchar(50)\",\"user_name\":\"varchar(100)\",\"app_id\":\"int(11)\",\"background\":\"varchar(500)\",\"head_img\":\"varchar(500)\",\"gender\":\"tinyint(4)\",\"country_id\":\"tinyint(4) unsigned\",\"country_name\":\"varchar(50)\",\"gold_num\":\"decimal(10,0)\",\"language_id\":\"varchar(200)\",\"language_name\":\"varchar(500)\",\"age\":\"tinyint(4)\",\"birthday\":\"date\",\"platform_type\":\"tinyint(4) unsigned\",\"type\":\"tinyint(4)\",\"pay_status\":\"tinyint(4)\",\"status\":\"tinyint(4)\",\"create_time\":\"timestamp\",\"update_time\":\"timestamp\",\"stone\":\"decimal(10,0)\",\"stone_version\":\"int(11)\",\"introduce\":\"varchar(500)\",\"eroticism_behavior\":\"tinyint(1)\",\"sign_eroticism\":\"tinyint(1)\",\"channel\":\"tinyint(4)\"},\"old\":[{\"update_time\":\"2020-01-14 16:43:57\"}],\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"user_account\":12,\"three_party_id\":12,\"three_party_email\":12,\"password\":12,\"user_name\":12,\"app_id\":4,\"background\":12,\"head_img\":12,\"gender\":-6,\"country_id\":-6,\"country_name\":12,\"gold_num\":3,\"language_id\":12,\"language_name\":12,\"age\":-6,\"birthday\":91,\"platform_type\":-6,\"type\":-6,\"pay_status\":-6,\"status\":-6,\"create_time\":93,\"update_time\":93,\"stone\":3,\"stone_version\":4,\"introduce\":12,\"eroticism_behavior\":-7,\"sign_eroticism\":-7,\"channel\":-6},\"table\":\"rc_user\",\"ts\":1579020248209,\"type\":\"UPDATE\"}"
    val json = test
    val schemaMap = ReadSchemaConfig.getConfig()
    val titles = schemaMap.map(_._2.values).flatten.filter(_.display == 1).map(_.colName).toSet.toList.sorted
    val stp = StructType(titles.map(t => StructField(t, StringType)))
    val m = List(("", json)).iterator
    val list = MonitorStorage(null).clearData(m, schemaMap, titles).toList.asJava
    val spark = SparkSession.builder().appName("xx").master("local[2]").getOrCreate()

    spark.createDataFrame(list, stp).createOrReplaceTempView("tb")
    spark.sql("select * from tb").show
    spark.sql("select create_time,user_id,register_time,platform_type,app_id,country_name,gender,new_user_flg,pay_status,frist_pay_flg,eroticism_behavior,channel,type,version,vip,sign_eroticism,role,tolerance,sexRate,thumbs,pay_money_sum,pay_gold_num_sum,status,gold_balance,remote_user_id,remote_register_time,remote_match_user_platform,remote_match_app_id,remote_match_user_country,remote_gender,remote_new_user_flg,remote_match_user_pay,remote_frist_pay_flg,remote_eroticism_behavior,remote_channel,remote_type,remote_version,remote_vip,remote_sign_eroticism,remote_role,remote_tolerance,remote_sexRate,remote_thumbs,remote_pay_money_sum,remote_pay_gold_num_sum,remote_status,remote_gold_balance,pay_platform,money,gold_num,is_friend,action_source,is_real_user,online_flg,comm,alarm_service_list,date_format(create_date,'yyyyMMddHH') create_date,to_date(create_time) dt from tb").show()
  }

}
